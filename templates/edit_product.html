{% extends "base_page.html" %}

{% block title %}DealsShare - Edit product{% endblock %}

<!-- Admin Button (Visible only to admin users) -->
{% block Admin %}
    {% if user["role"] == 'admin' %}
        <a href="{{ url_for('admin') }}" class="admin-float-btn">
            ⚙️ Admin
        </a>
    {% endif %}
{% endblock %}

{% block sentence %}Edit product{% endblock %}

{% block content %}

<!-- Form Container -->
<div class="container">
    <form action="{{ url_for('edit_product', product_id=product['id']) }}" 
          method="POST" enctype="multipart/form-data" class="product-form">

        <input type="hidden" name="product_id" value="{{ product['id'] }}">

        <!-- Product Name -->
        <label for="name">Product Name</label>
        <input type="text" id="name" name="name" value="{{ product['name'] }}" required>

        <!-- Key Features -->
        <label for="features">Key Features (2-3, comma-separated)</label>
        <input type="text" id="features" name="features" value="{{ product['features'] }}" maxlength="40" required>

        <!-- Detailed Description -->
        <label for="description">Detailed Description</label>
        <textarea id="description" name="description" rows="4" maxlength="300" required>{{ product['description'] }}</textarea>

        <!-- Category Selection -->
        <label for="category">Category</label>
        <select id="category" name="category" required>
            <option value="" disabled {% if not product['category'] %}selected{% endif %}>Select a category</option>
            {% set categories = ['home', 'electronics', 'clothing', 'Shoes', 'toys', 'kitchen', 'jewellery', 'office'] %}
            {% for cat in categories %}
                <option value="{{ cat }}" {% if product['category'] == cat %}selected{% endif %}>
                    {{ cat.replace('_',' ')|capitalize }}
                </option>
            {% endfor %}
        </select>

        <!-- Free Shipping Checkbox -->
        <label>
            <input type="checkbox" name="free_shipping" value="1" {% if product['free_shipping'] %}checked{% endif %}>
            Free Shipping
        </label>

        <!-- Product Image -->
        <label for="image">Product Image</label>
        <img src="{{ url_for('static', filename='uploads/' ~ product['image_url'].split('/')[-1]) }}" 
             alt="Current product image" style="max-width:80px; display:block; margin-bottom:10px;">
        <input type="file" id="image" name="image" accept="image/*">

        <!-- Regular Price -->
        <label for="regular_price">Regular Price</label>
        <div class="input-wrapper">
            <span class="currency">₪</span>
            <input type="number" id="regular_price" name="regular_price" step="0.01" value="{{ product['regular_price'] }}" required>
        </div>

        <!-- Sale Price -->
        <label for="discount_price">Sale Price</label>
        <div class="input-wrapper">
            <span class="currency">₪</span>
            <input type="number" id="discount_price" name="discount_price" step="0.01" value="{{ product['discount_price'] }}">
        </div>

        <!--Expiry Date -->
        <label for="expiry_date">Expiry Date (1-14 days from now)</label>
        <input type="date" id="expiry_date" name="expiry_date" required 
            min="{{ min_date }}" max="{{ max_date }}" value="{{ product['expiry_date'] }}">

        <!-- Product Link -->
        <label for="link">Product Link</label>
        <input type="url" id="link" name="link" value="{{ product['product_link'] }}" required>

        <!-- Submit Button -->
        <button type="submit" class="btn">Save Changes</button>

    </form>
</div>

{% endblock %}
